<?php

/**
 * EiParamTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class EiParamTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object EiParamTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('EiParam');
    }
    public function getEiParams(){
        return $this->getInstance()->createQuery('p');
    }
    
    
    //Récupération des paramètres d'une fonction en meme temps que les paramètres sous script
    public function getParamByFunctionId($id_fonction){
        if($id_fonction==null) return null;
        return Doctrine_Query::create()
                ->select('*')
                ->from('EiParam p')
                ->leftJoin('p.EiFunctionHasParam p2')
                ->where('p.param_id=p2.param_id And p.id_fonction=?',array($id_fonction))
                ->execute();
    }
    
    
    public function getParamByCriteria($q,$id_fonction,$ei_version_id ,$ei_scenario_id,$id_kal_param,$valeur,$observation,$created_at,$updated_at){
        
            $q=$this->getEiParams();

            //paramètres d'une fonction spécifique
            if($id_fonction !=null) {
                $q=$q->andWhere('p.id_fonction = ?', $id_fonction);
            }

            //paramètres d'une version précise
            if($ei_version_id !=null) {
                $q=$q->andWhere('p.ei_version_id = ?', $ei_version_id);
            }

            //paramètres d'un scénario spécifique
            if($ei_scenario_id !=null) {

                $q=$q->andWhere('p.ei_scenario_id = ?', $ei_scenario_id);
            }

            //paramètres referencant une fonction kalifast donnée
            if($id_kal_param !=null) {
                $q=$q->andWhere('p.kal_param= ?', $id_kal_param);
            }

            //paramètres d'une valeur donnée
            if($valeur !=null){
                $q=$q->andWhere('p.valeur LIKE ?', '%'.$valeur.'%');
            }

            //paramètres d'une observation donnée
            if($observation !=null){
                $q=$q->andWhere('p.observation LIKE ?', '%'.$observation.'%');
            }
            
            //paramètres créées à une date donnée
            if($created_at !=null) {
                $q=$q->andWhere('p.created_at = ?', $created_at);
            }

            //paramètres par date de mise à jour
            if($updated_at !=null) {
                $q=$q->andWhere('p.updated_at= ?', $updated_at);
            }
            // retour de la requete
            $q=$q->orderBy('p.created_at');
            return $q;
    }

}