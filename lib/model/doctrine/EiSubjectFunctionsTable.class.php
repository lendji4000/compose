<?php

/**
 * EiSubjectFunctionsTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class EiSubjectFunctionsTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object EiSubjectFunctionsTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('EiSubjectFunctions');
    }
    public static function createNewLink(KalFunction $kal_fonction ,EiSubject $bug,$automate=false,Doctrine_Connection $conn = null){ 
        if ($conn == null)
            $conn = Doctrine_Manager::connection();
        $newLink=new EiSubjectFunctions();
        $newLink->setKalFunction($kal_fonction);
        $newLink->setSubjectId($bug->getId());
        $newLink->setAutomate($automate);
        $currentLink=Doctrine_core::getTable('EiSubjectFunctions')->findOneBySubjectIdAndFunctionIdAndFunctionRef(
                $bug->getId(),$kal_fonction->getFunctionId(),$kal_fonction->getFunctionRef());
        if($currentLink==null):
            $newLink->save($conn); //La liaison n'existe pas: on la crÃ©e.
        endif;  
        if($currentLink!=null && !$currentLink->getAutomate()): 
            $currentLink->setAutomate($automate); //La liaison existe mais n'est pas forte: on la rend forte.
            $currentLink->save($conn);
        endif;
    }
}