<?php

/**
 * EiLog
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    kalifastRobot
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class EiLog extends BaseEiLog
{
    
    public function isPlaying(){
        return $this->getStatus() == StatusConst::STATUS_PROCESSING_DB || $this->getStatus() == StatusConst::STATUS_BLANK_DB;
    }
    
    /**
     * Assigne la date de fin d'execution relatif Ã  la log et en effectue la sauvegarde
     */
    public function closeExecution(){
        $date = new DateTime();
        $date_str = $date->format('Y-m-d H:i:s');
        $this->setDateFin($date_str);
        
        $date_debut = DateTime::createFromFormat('Y-m-d H:i:s', $this->getDateDebut());
        $duree = $date_debut->diff($date);
        
        $timeFirst = strtotime($this->getDateDebut());
        $timeSecond = strtotime($this->getDateFin());
        
        $this->setDuree($timeSecond - $timeFirst);
        
        //si le status est a playing, alors le JDT s'est correctement executÃ©.
        if($this->isPlaying())
            $this->setStatus (StatusConst::STATUS_OK_DB);
        
        $this->save();
    }
    
    public function save(\Doctrine_Connection $conn = null) {
        if($this->isNew()){
            $date = new DateTime();
            $date = $date->format('Y-m-d H:i:s');
            $this->setDateDebut($date);
        }
            
        parent::save($conn);
    }
}
