<?php

/**
 * EiLeafDataSet
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    kalifastRobot
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class EiLeafDataSet extends BaseEiLeafDataSet implements ISluggableXML, ITree
{

    /**
     * Retourne le nom de l'objet sous-forme de tag XML.
     *
     * @return mixed
     */
    public function getXMLTag()
    {
        return MyFunction::sluggifyForXML($this->getName());
    }

    /**
     * @return mixed
     */
    public function getPath()
    {
        return $this->getNode()->getPath(' > ', true);
    }

    /**
     * Génére l'élément XSD relatif à la feuille.
     *
     * @param DOMDocument $documentXsd
     * @return mixed
     */
    public function generateXSD($documentXsd)
    {
        $element = $documentXsd->createElement("xs:element");

        $element->setAttribute('name', $this->getXMLTag());

        return $element;
    }

    /**
     * @param DOMDocument $documentXml
     * @param DOMDocument $parent
     */
    public function generateXML($documentXml, $parent)
    {
        $element = $documentXml->createElement($this->getXMLTag(), "");
        $parent->appendChild($element);
    }

    public static function getFormNameFormat()
    {
        $form = new EiLeafDataSetForm();

        return $form->getWidgetSchema()->getNameFormat();
    }

    /**********          GESTION DES JEUX DE DONNEES
    /******************************************************************************************************************/

    /**
     * Création des lignes de jeux de données.
     *
     * @param EiDataSet $ds
     * @param null $parent
     */
    public function createEmptyDataLines($ds = null, $parent = null){

        $line = new EiDataLine();
        $line->setEiDataSet($ds);
        $line->setLft($this->getLft());
        $line->setRgt($this->getRgt());
        $line->setLevel($this->getLevel());
        $line->setEiDataLineParent($parent);

        if( $parent == null ){
            $ds->setRootStr($line);
        }
    }

    public function save(Doctrine_Connection $conn = null)
    {
        $this->setSlug($this->getXMLTag());

        if( ($this->getEiScenarioId() == null || $this->getProjectId() == null) && $this->getEiDataSetStructureParent() != null){

            $this->setEiScenarioId($this->getEiDataSetStructureParent()->getEiScenarioId());
            $this->setProjectId($this->getEiDataSetStructureParent()->getProjectId());
            $this->setProjectRef($this->getEiDataSetStructureParent()->getProjectRef());
            $this->setRootId($this->getEiDataSetStructureParent()->getRootId());
        }

        parent::save($conn); // TODO: Change the autogenerated stub
    }
}